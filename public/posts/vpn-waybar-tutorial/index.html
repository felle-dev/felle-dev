<!DOCTYPE html>
<html lang="en-us" dir="ltr">
<head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script>
  

<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="shortcut icon" type="image/png" href="http://localhost:1313/favicon.ico" />
<meta property="og:url" content="http://localhost:1313/posts/vpn-waybar-tutorial/">
  <meta property="og:site_name" content="felle.site/">
  <meta property="og:title" content="How to create a custom VPN toggle script for Waybar">
  <meta property="og:description" content="Tutorial showcasing how to build a custom VPN toggle script with random server selection for Waybar using ProtonVPN and OpenVPN.">
  <meta property="og:locale" content="en_us">
  <meta property="og:type" content="article">
    <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2026-01-18T00:00:00+00:00">
    <meta property="article:modified_time" content="2026-01-18T00:00:00+00:00">
    <meta property="article:tag" content="GNU/Linux">
    <meta property="article:tag" content="Tutorials">
    <meta property="article:tag" content="VPN">

<title>felle.site/ | How to create a custom VPN toggle script for Waybar</title>

    <link rel="stylesheet" href="/css/main.css">
  
      <link rel="stylesheet" href="/css/palette/eink.css">

      <script src="/js/main.js"></script>

<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">

</head>

  
<body
>
  
  <main>
    
  <div class="container pt-5">
    <div class="row mt-5 pt-5">
      
  <nav aria-label="breadcrumb" class="small navbar navbar-expand-lg">
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#collapsibleMenu" aria-controls="collapsibleMenu" aria-expanded="false" aria-label="Toggle navigation">
        <span class="navbar-toggler-icon"></span>
    </button>
    <div class="collapse navbar-collapse mt-3 mt-md-0" id="collapsibleMenu">
      <ol class="breadcrumb fw-bold">
    <li class="breadcrumb-item my-1 my-md-0 ms-3 ms-md-0">
      <a href="/"
        
      >home</a>
      
    </li>
    <li class="breadcrumb-item my-1 my-md-0 ms-3 ms-md-0">
      <a href="/about"
        
      >about</a>
      
    </li>
    <li class="breadcrumb-item my-1 my-md-0 ms-3 ms-md-0">
      <a href="/posts"
        class="text-decoration-underline link-offset-3"
        
      >posts</a>
      
    </li>
    <li class="breadcrumb-item my-1 my-md-0 ms-3 ms-md-0">
      <a href="/tags"
        
      >tags</a>
      
    </li>
      </ol>
    </div>
  </nav>

    </div>
    <div class="post">
      <header class="mb-4">
        <h1 class="text-uppercase">How to create a custom VPN toggle script for Waybar</h1>
        
        
        <div aria-label="breadcrumb">
          <ol class="breadcrumb">
            <li class="breadcrumb-item small">
              
              <time datetime="2026-01-18T00:00:00&#43;00:00">January 18, 2026</time>
            </li>
            
            
            <li class="breadcrumb-item small">
              9 minutes
            </li>
          </ol>
        </div>
      </header>
      
      <article>
        <p>This tutorial demonstrates how to build a custom VPN toggle script for Waybar that integrates with ProtonVPN, provides random server selection, and sends desktop notifications.</p>
<h2 id="overview">Overview</h2>
<p>Managing VPN connections through terminal commands gets old fast. You type the same commands over and over, manually pick servers, and lose track of whether you&rsquo;re connected or not. This guide walks through building a Waybar module that handles all of this with a single click.</p>
<p>The final result shows your current VPN status in your status bar, lets you toggle the connection with one click, randomly selects from your available servers, and sends desktop notifications when connections change. The whole thing is about 100 lines of bash split across two scripts.</p>
<h2 id="prerequisites">Prerequisites</h2>
<p>You&rsquo;ll need a Linux system with systemd, a ProtonVPN account (free tier works fine), and Waybar already installed and configured. You should be comfortable with basic bash scripting and have root or sudo access for system configuration.</p>
<h2 id="environment-setup">Environment Setup</h2>
<p>First, install OpenVPN and notification support. On Arch Linux, run <code>sudo pacman -S openvpn libnotify</code>. For Ubuntu or Debian, use <code>sudo apt install openvpn libnotify-bin</code>. Fedora users need <code>sudo dnf install openvpn libnotify</code>.</p>
<h3 id="getting-protonvpn-configuration-files">Getting ProtonVPN Configuration Files</h3>
<p>Head to account.protonvpn.com and go to Downloads, then OpenVPN configuration files. Pick the servers you want to use and download them. You can grab as many as you want - the script will randomly select from whatever you provide.</p>
<p>Move those downloaded configs to the OpenVPN directory with <code>sudo mv ~/Downloads/*.ovpn /etc/openvpn/client/</code>. Then rename them from .ovpn to .conf, which systemd requires. Change to the directory with <code>cd /etc/openvpn/client/</code> and run this loop:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#ff79c6">for</span> file in *.ovpn; <span style="color:#ff79c6">do</span>
</span></span><span style="display:flex;"><span>    sudo mv <span style="color:#f1fa8c">&#34;</span><span style="color:#8be9fd;font-style:italic">$file</span><span style="color:#f1fa8c">&#34;</span> <span style="color:#f1fa8c">&#34;</span><span style="color:#f1fa8c">${</span><span style="color:#8be9fd;font-style:italic">file</span>%.ovpn<span style="color:#f1fa8c">}</span><span style="color:#f1fa8c">.conf&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">done</span>
</span></span></code></pre></div><p>The .conf extension isn&rsquo;t optional. Systemd&rsquo;s OpenVPN service won&rsquo;t recognize .ovpn files.</p>
<h3 id="setting-up-authentication">Setting Up Authentication</h3>
<p>Create a credentials file at <code>/etc/openvpn/client/protonvpn-credentials.txt</code> with your ProtonVPN username on the first line and password on the second line. Lock down the permissions with <code>sudo chown openvpn:openvpn /etc/openvpn/client/protonvpn-credentials.txt</code> followed by <code>sudo chmod 600 /etc/openvpn/client/protonvpn-credentials.txt</code>.</p>
<p>The downloaded config files reference auth-user-pass without specifying the credentials file path. Fix that with this sed command:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>sudo sed -i <span style="color:#f1fa8c">&#39;s|^auth-user-pass$|auth-user-pass /etc/openvpn/client/protonvpn-credentials.txt|&#39;</span> /etc/openvpn/client/*.conf
</span></span></code></pre></div><p>Verify it worked by running <code>grep &quot;auth-user-pass&quot; /etc/openvpn/client/*.conf</code>. Each line should show the full path to your credentials file.</p>
<h3 id="adjusting-systemd-timeout">Adjusting Systemd Timeout</h3>
<p>OpenVPN connections can take a while to establish, especially on slower networks. The default systemd timeout is too aggressive and will kill connections before they finish establishing. Create an override to bump the timeout to 120 seconds:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>sudo mkdir -p /etc/systemd/system/openvpn-client@.service.d/
</span></span><span style="display:flex;"><span>sudo tee /etc/systemd/system/openvpn-client@.service.d/override.conf <span style="color:#f1fa8c">&lt;&lt;EOF
</span></span></span><span style="display:flex;"><span><span style="color:#f1fa8c">[Service]
</span></span></span><span style="display:flex;"><span><span style="color:#f1fa8c">TimeoutStartSec=120
</span></span></span><span style="display:flex;"><span><span style="color:#f1fa8c">EOF</span>
</span></span><span style="display:flex;"><span>sudo systemctl daemon-reload
</span></span></code></pre></div><h2 id="script-implementation">Script Implementation</h2>
<p>The setup uses two scripts in your Waybar config directory. The toggle script manages connections and the status script displays current state.</p>
<h3 id="vpn-toggle-script">VPN Toggle Script</h3>
<p>Create the file at <code>~/.config/waybar/vpn-toggle.sh</code> and make it executable with <code>chmod +x ~/.config/waybar/vpn-toggle.sh</code>. Here&rsquo;s the complete script:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#ff79c6">#!/bin/bash
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"># VPN Toggle Script for ProtonVPN with Random Server Selection</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#8be9fd;font-style:italic">CONFIGS</span><span style="color:#ff79c6">=(</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f1fa8c">&#34;ca-free&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f1fa8c">&#34;jp-free&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f1fa8c">&#34;no-free&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f1fa8c">&#34;mx-free-12.protonvpn.udp&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f1fa8c">&#34;nl-free-135.protonvpn.udp&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f1fa8c">&#34;pl-free-2.protonvpn.udp&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f1fa8c">&#34;ro-free-28.protonvpn.udp&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f1fa8c">&#34;sg-free-15.protonvpn.udp&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f1fa8c">&#34;ch-free-4.protonvpn.udp&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#8be9fd;font-style:italic">STATE_FILE</span><span style="color:#ff79c6">=</span><span style="color:#f1fa8c">&#34;/tmp/protonvpn-state&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#8be9fd;font-style:italic">CURRENT_FILE</span><span style="color:#ff79c6">=</span><span style="color:#f1fa8c">&#34;/tmp/protonvpn-current&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#6272a4"># Map country codes to full names</span>
</span></span><span style="display:flex;"><span>get_country_name<span style="color:#ff79c6">()</span> <span style="color:#ff79c6">{</span>
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">case</span> <span style="color:#f1fa8c">&#34;</span><span style="color:#8be9fd;font-style:italic">$1</span><span style="color:#f1fa8c">&#34;</span> in
</span></span><span style="display:flex;"><span>        ca<span style="color:#ff79c6">)</span> <span style="color:#8be9fd;font-style:italic">echo</span> <span style="color:#f1fa8c">&#34;Canada&#34;</span> ;;
</span></span><span style="display:flex;"><span>        jp<span style="color:#ff79c6">)</span> <span style="color:#8be9fd;font-style:italic">echo</span> <span style="color:#f1fa8c">&#34;Japan&#34;</span> ;;
</span></span><span style="display:flex;"><span>        no<span style="color:#ff79c6">)</span> <span style="color:#8be9fd;font-style:italic">echo</span> <span style="color:#f1fa8c">&#34;Norway&#34;</span> ;;
</span></span><span style="display:flex;"><span>        mx<span style="color:#ff79c6">)</span> <span style="color:#8be9fd;font-style:italic">echo</span> <span style="color:#f1fa8c">&#34;Mexico&#34;</span> ;;
</span></span><span style="display:flex;"><span>        nl<span style="color:#ff79c6">)</span> <span style="color:#8be9fd;font-style:italic">echo</span> <span style="color:#f1fa8c">&#34;Netherlands&#34;</span> ;;
</span></span><span style="display:flex;"><span>        pl<span style="color:#ff79c6">)</span> <span style="color:#8be9fd;font-style:italic">echo</span> <span style="color:#f1fa8c">&#34;Poland&#34;</span> ;;
</span></span><span style="display:flex;"><span>        ro<span style="color:#ff79c6">)</span> <span style="color:#8be9fd;font-style:italic">echo</span> <span style="color:#f1fa8c">&#34;Romania&#34;</span> ;;
</span></span><span style="display:flex;"><span>        sg<span style="color:#ff79c6">)</span> <span style="color:#8be9fd;font-style:italic">echo</span> <span style="color:#f1fa8c">&#34;Singapore&#34;</span> ;;
</span></span><span style="display:flex;"><span>        ch<span style="color:#ff79c6">)</span> <span style="color:#8be9fd;font-style:italic">echo</span> <span style="color:#f1fa8c">&#34;Switzerland&#34;</span> ;;
</span></span><span style="display:flex;"><span>        *<span style="color:#ff79c6">)</span> <span style="color:#8be9fd;font-style:italic">echo</span> <span style="color:#f1fa8c">&#34;Unknown&#34;</span> ;;
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">esac</span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#6272a4"># Check if VPN is active</span>
</span></span><span style="display:flex;"><span>is_vpn_running<span style="color:#ff79c6">()</span> <span style="color:#ff79c6">{</span>
</span></span><span style="display:flex;"><span>    systemctl is-active --quiet <span style="color:#f1fa8c">&#34;openvpn-client@*&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#6272a4"># Stop all VPN connections</span>
</span></span><span style="display:flex;"><span>stop_vpn<span style="color:#ff79c6">()</span> <span style="color:#ff79c6">{</span>
</span></span><span style="display:flex;"><span>    sudo systemctl stop <span style="color:#f1fa8c">&#34;openvpn-client@*&#34;</span> 2&gt;/dev/null
</span></span><span style="display:flex;"><span>    rm -f <span style="color:#f1fa8c">&#34;</span><span style="color:#8be9fd;font-style:italic">$STATE_FILE</span><span style="color:#f1fa8c">&#34;</span> <span style="color:#f1fa8c">&#34;</span><span style="color:#8be9fd;font-style:italic">$CURRENT_FILE</span><span style="color:#f1fa8c">&#34;</span>
</span></span><span style="display:flex;"><span>    sleep 0.5
</span></span><span style="display:flex;"><span>    notify-send -t <span style="color:#bd93f9">3000</span> -u normal <span style="color:#f1fa8c">&#34;VPN Disconnected&#34;</span> <span style="color:#f1fa8c">&#34;Your connection is no longer protected&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#6272a4"># Start random VPN connection</span>
</span></span><span style="display:flex;"><span>start_vpn<span style="color:#ff79c6">()</span> <span style="color:#ff79c6">{</span>
</span></span><span style="display:flex;"><span>    sudo systemctl stop <span style="color:#f1fa8c">&#34;openvpn-client@*&#34;</span> 2&gt;/dev/null
</span></span><span style="display:flex;"><span>    sleep <span style="color:#bd93f9">1</span>
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#6272a4"># Random server selection</span>
</span></span><span style="display:flex;"><span>    <span style="color:#8be9fd;font-style:italic">RANDOM_CONFIG</span><span style="color:#ff79c6">=</span><span style="color:#f1fa8c">&#34;</span><span style="color:#f1fa8c">${</span><span style="color:#8be9fd;font-style:italic">CONFIGS</span>[<span style="color:#8be9fd;font-style:italic">$RANDOM</span> % <span style="color:#f1fa8c">${#</span><span style="color:#8be9fd;font-style:italic">CONFIGS</span>[@]<span style="color:#f1fa8c">}</span>]<span style="color:#f1fa8c">}</span><span style="color:#f1fa8c">&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#8be9fd;font-style:italic">COUNTRY_CODE</span><span style="color:#ff79c6">=</span><span style="color:#ff79c6">$(</span><span style="color:#8be9fd;font-style:italic">echo</span> <span style="color:#f1fa8c">&#34;</span><span style="color:#8be9fd;font-style:italic">$RANDOM_CONFIG</span><span style="color:#f1fa8c">&#34;</span> | cut -d<span style="color:#f1fa8c">&#39;-&#39;</span> -f1<span style="color:#ff79c6">)</span>
</span></span><span style="display:flex;"><span>    <span style="color:#8be9fd;font-style:italic">COUNTRY_NAME</span><span style="color:#ff79c6">=</span><span style="color:#ff79c6">$(</span>get_country_name <span style="color:#f1fa8c">&#34;</span><span style="color:#8be9fd;font-style:italic">$COUNTRY_CODE</span><span style="color:#f1fa8c">&#34;</span><span style="color:#ff79c6">)</span>
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    notify-send -t <span style="color:#bd93f9">3000</span> -u normal <span style="color:#f1fa8c">&#34;VPN Connecting&#34;</span> <span style="color:#f1fa8c">&#34;Connecting to </span><span style="color:#8be9fd;font-style:italic">$COUNTRY_NAME</span><span style="color:#f1fa8c">...&#34;</span>
</span></span><span style="display:flex;"><span>    sudo systemctl start <span style="color:#f1fa8c">&#34;openvpn-client@</span><span style="color:#f1fa8c">${</span><span style="color:#8be9fd;font-style:italic">RANDOM_CONFIG</span><span style="color:#f1fa8c">}</span><span style="color:#f1fa8c">&#34;</span>
</span></span><span style="display:flex;"><span>    sleep <span style="color:#bd93f9">3</span>
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#6272a4"># Verify connection</span>
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">if</span> systemctl is-active --quiet <span style="color:#f1fa8c">&#34;openvpn-client@</span><span style="color:#f1fa8c">${</span><span style="color:#8be9fd;font-style:italic">RANDOM_CONFIG</span><span style="color:#f1fa8c">}</span><span style="color:#f1fa8c">&#34;</span>; <span style="color:#ff79c6">then</span>
</span></span><span style="display:flex;"><span>        <span style="color:#8be9fd;font-style:italic">echo</span> <span style="color:#f1fa8c">&#34;connected&#34;</span> &gt; <span style="color:#f1fa8c">&#34;</span><span style="color:#8be9fd;font-style:italic">$STATE_FILE</span><span style="color:#f1fa8c">&#34;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#8be9fd;font-style:italic">echo</span> <span style="color:#f1fa8c">&#34;</span><span style="color:#8be9fd;font-style:italic">$RANDOM_CONFIG</span><span style="color:#f1fa8c">&#34;</span> &gt; <span style="color:#f1fa8c">&#34;</span><span style="color:#8be9fd;font-style:italic">$CURRENT_FILE</span><span style="color:#f1fa8c">&#34;</span>
</span></span><span style="display:flex;"><span>        notify-send -t <span style="color:#bd93f9">3000</span> -u normal <span style="color:#f1fa8c">&#34;VPN Connected&#34;</span> <span style="color:#f1fa8c">&#34;Connected to </span><span style="color:#8be9fd;font-style:italic">$COUNTRY_NAME</span><span style="color:#f1fa8c">&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">else</span>
</span></span><span style="display:flex;"><span>        notify-send -t <span style="color:#bd93f9">3000</span> -u critical <span style="color:#f1fa8c">&#34;VPN Failed&#34;</span> <span style="color:#f1fa8c">&#34;Could not connect to </span><span style="color:#8be9fd;font-style:italic">$COUNTRY_NAME</span><span style="color:#f1fa8c">&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">fi</span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#6272a4"># Toggle logic</span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">if</span> is_vpn_running; <span style="color:#ff79c6">then</span>
</span></span><span style="display:flex;"><span>    stop_vpn
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">else</span>
</span></span><span style="display:flex;"><span>    start_vpn
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">fi</span>
</span></span></code></pre></div><p>The CONFIGS array holds your available VPN configurations. These names must match the .conf files in <code>/etc/openvpn/client/</code> without the extension. The script uses two temporary files to track connection state and which server is currently active. This information gets passed to the status script.</p>
<p>The get_country_name function converts two-letter country codes to full names for notifications. Add more cases here if you&rsquo;re using servers from additional countries.</p>
<p>When you click the Waybar module, is_vpn_running checks if any OpenVPN service is active. If something is running, stop_vpn kills all connections and cleans up the state files. If nothing is running, start_vpn picks a random server from your array and attempts to connect.</p>
<p>The start_vpn function does a few things. It stops any existing connections first (in case something is stuck), waits a second for cleanup, then randomly selects a server. It extracts the country code from the config name, looks up the full country name, and sends a notification that connection is starting.</p>
<p>After starting the systemd service, the script waits three seconds and verifies the connection actually established. If successful, it writes to the state files and sends a success notification. If the connection failed, you get an error notification instead.</p>
<h3 id="vpn-status-script">VPN Status Script</h3>
<p>Create <code>~/.config/waybar/vpn-status.sh</code> and make it executable. This script runs every few seconds and outputs JSON that Waybar displays:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#ff79c6">#!/bin/bash
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"># VPN Status Script for Waybar</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#8be9fd;font-style:italic">CURRENT_FILE</span><span style="color:#ff79c6">=</span><span style="color:#f1fa8c">&#34;/tmp/protonvpn-current&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#6272a4"># Map country codes to full names</span>
</span></span><span style="display:flex;"><span>get_country_name<span style="color:#ff79c6">()</span> <span style="color:#ff79c6">{</span>
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">case</span> <span style="color:#f1fa8c">&#34;</span><span style="color:#8be9fd;font-style:italic">$1</span><span style="color:#f1fa8c">&#34;</span> in
</span></span><span style="display:flex;"><span>        ca<span style="color:#ff79c6">)</span> <span style="color:#8be9fd;font-style:italic">echo</span> <span style="color:#f1fa8c">&#34;Canada&#34;</span> ;;
</span></span><span style="display:flex;"><span>        jp<span style="color:#ff79c6">)</span> <span style="color:#8be9fd;font-style:italic">echo</span> <span style="color:#f1fa8c">&#34;Japan&#34;</span> ;;
</span></span><span style="display:flex;"><span>        no<span style="color:#ff79c6">)</span> <span style="color:#8be9fd;font-style:italic">echo</span> <span style="color:#f1fa8c">&#34;Norway&#34;</span> ;;
</span></span><span style="display:flex;"><span>        mx<span style="color:#ff79c6">)</span> <span style="color:#8be9fd;font-style:italic">echo</span> <span style="color:#f1fa8c">&#34;Mexico&#34;</span> ;;
</span></span><span style="display:flex;"><span>        nl<span style="color:#ff79c6">)</span> <span style="color:#8be9fd;font-style:italic">echo</span> <span style="color:#f1fa8c">&#34;Netherlands&#34;</span> ;;
</span></span><span style="display:flex;"><span>        pl<span style="color:#ff79c6">)</span> <span style="color:#8be9fd;font-style:italic">echo</span> <span style="color:#f1fa8c">&#34;Poland&#34;</span> ;;
</span></span><span style="display:flex;"><span>        ro<span style="color:#ff79c6">)</span> <span style="color:#8be9fd;font-style:italic">echo</span> <span style="color:#f1fa8c">&#34;Romania&#34;</span> ;;
</span></span><span style="display:flex;"><span>        sg<span style="color:#ff79c6">)</span> <span style="color:#8be9fd;font-style:italic">echo</span> <span style="color:#f1fa8c">&#34;Singapore&#34;</span> ;;
</span></span><span style="display:flex;"><span>        ch<span style="color:#ff79c6">)</span> <span style="color:#8be9fd;font-style:italic">echo</span> <span style="color:#f1fa8c">&#34;Switzerland&#34;</span> ;;
</span></span><span style="display:flex;"><span>        *<span style="color:#ff79c6">)</span> <span style="color:#8be9fd;font-style:italic">echo</span> <span style="color:#f1fa8c">&#34;VPN&#34;</span> ;;
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">esac</span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#6272a4"># Output JSON for Waybar</span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">if</span> systemctl is-active --quiet <span style="color:#f1fa8c">&#34;openvpn-client@*&#34;</span>; <span style="color:#ff79c6">then</span>
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">if</span> <span style="color:#ff79c6">[</span> -f <span style="color:#f1fa8c">&#34;</span><span style="color:#8be9fd;font-style:italic">$CURRENT_FILE</span><span style="color:#f1fa8c">&#34;</span> <span style="color:#ff79c6">]</span>; <span style="color:#ff79c6">then</span>
</span></span><span style="display:flex;"><span>        <span style="color:#8be9fd;font-style:italic">CONFIG</span><span style="color:#ff79c6">=</span><span style="color:#ff79c6">$(</span>cat <span style="color:#f1fa8c">&#34;</span><span style="color:#8be9fd;font-style:italic">$CURRENT_FILE</span><span style="color:#f1fa8c">&#34;</span><span style="color:#ff79c6">)</span>
</span></span><span style="display:flex;"><span>        <span style="color:#8be9fd;font-style:italic">COUNTRY_CODE</span><span style="color:#ff79c6">=</span><span style="color:#ff79c6">$(</span><span style="color:#8be9fd;font-style:italic">echo</span> <span style="color:#f1fa8c">&#34;</span><span style="color:#8be9fd;font-style:italic">$CONFIG</span><span style="color:#f1fa8c">&#34;</span> | cut -d<span style="color:#f1fa8c">&#39;-&#39;</span> -f1<span style="color:#ff79c6">)</span>
</span></span><span style="display:flex;"><span>        <span style="color:#8be9fd;font-style:italic">COUNTRY_NAME</span><span style="color:#ff79c6">=</span><span style="color:#ff79c6">$(</span>get_country_name <span style="color:#f1fa8c">&#34;</span><span style="color:#8be9fd;font-style:italic">$COUNTRY_CODE</span><span style="color:#f1fa8c">&#34;</span><span style="color:#ff79c6">)</span>
</span></span><span style="display:flex;"><span>        <span style="color:#8be9fd;font-style:italic">echo</span> <span style="color:#f1fa8c">&#34;{\&#34;text\&#34;:\&#34; </span><span style="color:#8be9fd;font-style:italic">$COUNTRY_NAME</span><span style="color:#f1fa8c">\&#34;,\&#34;tooltip\&#34;:\&#34;VPN Connected: </span><span style="color:#8be9fd;font-style:italic">$CONFIG</span><span style="color:#f1fa8c">\&#34;,\&#34;class\&#34;:\&#34;connected\&#34;}&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">else</span>
</span></span><span style="display:flex;"><span>        <span style="color:#8be9fd;font-style:italic">echo</span> <span style="color:#f1fa8c">&#34;{\&#34;text\&#34;:\&#34; Connected\&#34;,\&#34;tooltip\&#34;:\&#34;VPN Connected\&#34;,\&#34;class\&#34;:\&#34;connected\&#34;}&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">fi</span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">else</span>
</span></span><span style="display:flex;"><span>    <span style="color:#8be9fd;font-style:italic">echo</span> <span style="color:#f1fa8c">&#34;{\&#34;text\&#34;:\&#34;󰷷 Disconnected\&#34;,\&#34;tooltip\&#34;:\&#34;VPN Disconnected - Click to connect\&#34;,\&#34;class\&#34;:\&#34;disconnected\&#34;}&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">fi</span>
</span></span></code></pre></div><p>The script checks if any OpenVPN service is active. If it finds one, it reads the current config from the state file, extracts the country code, looks up the country name, and outputs JSON with that information. The JSON includes text to display in the bar, tooltip text that appears on hover, and a CSS class for styling.</p>
<p>If no VPN is running, it outputs disconnected state with different text and class. Waybar parses this JSON and renders it accordingly.</p>
<h2 id="waybar-integration">Waybar Integration</h2>
<p>Open your Waybar config at <code>~/.config/waybar/config</code> and add the custom VPN module:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-json" data-lang="json"><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">&#34;modules-right&#34;</span>: [
</span></span><span style="display:flex;"><span>        <span style="color:#f1fa8c">&#34;custom/vpn&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#f1fa8c">&#34;pulseaudio&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#f1fa8c">&#34;clock&#34;</span>
</span></span><span style="display:flex;"><span>    ],
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">&#34;custom/vpn&#34;</span>: {
</span></span><span style="display:flex;"><span>        <span style="color:#ff79c6">&#34;exec&#34;</span>: <span style="color:#f1fa8c">&#34;~/.config/waybar/vpn-status.sh&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#ff79c6">&#34;interval&#34;</span>: <span style="color:#bd93f9">5</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#ff79c6">&#34;return-type&#34;</span>: <span style="color:#f1fa8c">&#34;json&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#ff79c6">&#34;on-click&#34;</span>: <span style="color:#f1fa8c">&#34;~/.config/waybar/vpn-toggle.sh&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#ff79c6">&#34;format&#34;</span>: <span style="color:#f1fa8c">&#34;{}&#34;</span>
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>The exec parameter points to your status script. Waybar runs this script every 5 seconds (controlled by interval) and expects JSON output (return-type). When you click the module, it runs the toggle script. The format field uses the text value from the JSON output.</p>
<h3 id="styling-the-module">Styling the Module</h3>
<p>Add some CSS to <code>~/.config/waybar/style.css</code> to differentiate connected and disconnected states:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-css" data-lang="css"><span style="display:flex;"><span>#custom-vpn.<span style="color:#50fa7b">connected</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">background-color</span>: <span style="color:#bd93f9">#a6e3a1</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">color</span>: <span style="color:#bd93f9">#1e1e2e</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">padding</span>: <span style="color:#bd93f9">0</span> <span style="color:#bd93f9">10</span><span style="color:#8be9fd">px</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">margin</span>: <span style="color:#bd93f9">0</span> <span style="color:#bd93f9">5</span><span style="color:#8be9fd">px</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">border-radius</span>: <span style="color:#bd93f9">5</span><span style="color:#8be9fd">px</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">font-weight</span>: <span style="color:#ff79c6">bold</span>;
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>#custom-vpn.<span style="color:#50fa7b">disconnected</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">background-color</span>: <span style="color:#bd93f9">#f38ba8</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">color</span>: <span style="color:#bd93f9">#1e1e2e</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">padding</span>: <span style="color:#bd93f9">0</span> <span style="color:#bd93f9">10</span><span style="color:#8be9fd">px</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">margin</span>: <span style="color:#bd93f9">0</span> <span style="color:#bd93f9">5</span><span style="color:#8be9fd">px</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">border-radius</span>: <span style="color:#bd93f9">5</span><span style="color:#8be9fd">px</span>;
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>These colors come from the Catppuccin theme. Adjust them to match your color scheme. The connected class uses green, disconnected uses red. Both get some padding and rounded corners to stand out in the bar.</p>
<h2 id="sudo-configuration">Sudo Configuration</h2>
<p>The toggle script needs to start and stop systemd services, which requires root privileges. You could run the script with sudo and type your password every time, but that defeats the purpose of a one-click toggle.</p>
<p>Configure passwordless sudo for just these specific commands. Run <code>sudo visudo</code> and add this line, replacing your_username with your actual username:</p>
<pre tabindex="0"><code>your_username ALL=(ALL) NOPASSWD: /usr/bin/systemctl start openvpn-client@*, /usr/bin/systemctl stop openvpn-client@*
</code></pre><p>This grants passwordless sudo access only for starting and stopping OpenVPN client services. Nothing else gets elevated privileges.</p>
<h2 id="testing">Testing</h2>
<p>Before integrating with Waybar, test the toggle script directly. Run <code>~/.config/waybar/vpn-toggle.sh</code> from a terminal. You should see a notification that the VPN is connecting, followed by another notification when it connects successfully.</p>
<p>Verify the connection is actually active with <code>systemctl status &quot;openvpn-client@*&quot;</code>. You should see an active service for whichever server the script randomly selected.</p>
<p>Test the status script with <code>~/.config/waybar/vpn-status.sh</code>. It should output JSON showing your connected state and country.</p>
<p>Restart Waybar to load the new module with <code>killall waybar &amp;&amp; waybar &amp;</code>. The VPN module should appear in your bar showing current status. Click it to toggle the connection. You should see notifications and the status should update within 5 seconds.</p>
<h2 id="customization">Customization</h2>
<p>Adding more servers is straightforward. Just add config names to the CONFIGS array and update the country mapping function with any new country codes. The config names must match your .conf files in <code>/etc/openvpn/client/</code> without the extension.</p>
<p>If you want custom notification icons, modify the notify-send commands to include <code>-i network-vpn</code> or whatever icon name you prefer. You can find available icon names with <code>ls /usr/share/icons/*/status/</code>.</p>
<p>For connection logging, add a log file variable like <code>LOG_FILE=&quot;$HOME/.local/share/vpn-toggle.log&quot;</code> at the top of the toggle script. Then append log entries after successful connections with <code>echo &quot;$(date): Connected to $COUNTRY_NAME&quot; &gt;&gt; &quot;$LOG_FILE&quot;</code> and similar for disconnections.</p>
<h2 id="troubleshooting">Troubleshooting</h2>
<p>If connections aren&rsquo;t establishing, check the OpenVPN logs with <code>sudo journalctl -u openvpn-client@* -f</code>. This shows real-time log output and will reveal authentication problems, network issues, or configuration errors.</p>
<p>Authentication failures usually mean wrong credentials or incorrect file paths in the config files. Verify your credentials file with <code>sudo cat /etc/openvpn/client/protonvpn-credentials.txt</code> and check permissions with <code>ls -la /etc/openvpn/client/protonvpn-credentials.txt</code>. The file should be owned by openvpn:openvpn with 600 permissions.</p>
<p>If connections timeout, increase the systemd timeout value in the override file. Edit <code>/etc/systemd/system/openvpn-client@.service.d/override.conf</code> and change TimeoutStartSec to 180 or higher. Run <code>sudo systemctl daemon-reload</code> after changing it.</p>
<p>When the Waybar module isn&rsquo;t updating, check that both scripts have execute permissions with <code>ls -la ~/.config/waybar/vpn-*.sh</code>. You should see <code>-rwxr-xr-x</code> for both files.</p>
<h2 id="conclusion">Conclusion</h2>
<p>This setup gives you one-click VPN management without leaving your desktop environment. The random server selection adds a privacy benefit by not always connecting to the same location, and desktop notifications keep you informed without having to check the status bar constantly.</p>
<p>The whole system uses standard Linux tools and requires minimal maintenance. Add or remove servers by editing one array. Change styling by editing CSS. The scripts are simple enough to modify for different VPN providers if you&rsquo;re using something other than ProtonVPN - just adjust the config file locations and names accordingly.</p>
      </article>
      
  <div class="tags pb-4 pt-2">
    
    
        <a class="badge rounded-pill text-uppercase text-bg-secondary" href="/tags/gnu/linux/">GNU/Linux</a>
        <a class="badge rounded-pill text-uppercase text-bg-secondary" href="/tags/tutorials/">Tutorials</a>
        <a class="badge rounded-pill text-uppercase text-bg-secondary" href="/tags/vpn/">VPN</a>
  </div>

      <div class="row">
    <div class="col-md">
        
    </div>
    <div class="col-md text-md-end">
        
        <a href="http://localhost:1313/posts/fends-app-project/">
            <span>next: </span>
            <span>Fends: A privacy-first approach to budget management</span>
        </a>
        
    </div>
</div>
      
    </div>
  </div>
  <footer>
    <div class="container mt-4 pb-1">
    <p class="small opacity-75">
        Felle © 2026
        
        // powered by <a href="https://gohugo.io/">hugo</a> and <a href="https://github.com/imgios/not-much">imgios/not-much</a>
        
    </p>
</div>

  </footer>

  </main>

  
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz" crossorigin="anonymous"></script>
  <script>
    function detectThemePreferences() {
      let themeClasses = ["text-dark"];
      if (window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches) {
          themeClasses = ["text-light", "dark"];
      }
      document.body.classList.add(...themeClasses);
    }

    detectThemePreferences();
  </script>
</body>
</html>
